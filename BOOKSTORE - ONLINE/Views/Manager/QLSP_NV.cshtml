@model IEnumerable<BOOKSTORE___ONLINE.Models.Entities.SACHs>

@{
    ViewBag.Title = "QLSP_NV";
    Layout = "~/Views/Shared/LayoutNhanVien.cshtml";
    var listAnh = ViewBag.AS as List<BOOKSTORE___ONLINE.Models.Entities.ANHSACHs>;
}

<div class="container-fluid py-3">

    <!-- HEADER -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
        <div>
            <h4 class="fw-bold mb-0">📚 Quản lý sản phẩm kho</h4>
            <div class="text-muted small">Danh sách sách đang có trong kho</div>
        </div>

        <a class="btn btn-primary"
           href="@Url.Action("ThemSanPhamMoiVaoKho","Manager")">
            <i class="bi bi-plus-circle"></i> Thêm sản phẩm mới
        </a>
    </div>

    <!-- SEARCH -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            @using (Html.BeginForm("traCuuTonKho", "Manager", FormMethod.Post))
            {
                <div class="row g-2">
                    <div class="col-md-9">
                        <input type="text"
                               name="tenSP"
                               class="form-control"
                               placeholder="Nhập tên sản phẩm cần tra cứu..." />
                    </div>
                    <div class="col-md-3 d-grid">
                        <button class="btn btn-outline-primary">
                            <i class="bi bi-search"></i> Tra cứu
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- ALERT -->
    @if (TempData["Loi"] != null)
    {
        <div class="alert alert-danger">
            @TempData["Loi"]
        </div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-danger">
            @TempData["Success"]
        </div>
    }

    <!-- TABLE -->
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-primary text-center">
                    <tr>
                        <th>Mã sách</th>
                        <th>Mã danh mục</th>
                        <th>Tên sách</th>
                        <th>Tác giả</th>
                        <th>NXB</th>
                        <th>Giá bán</th>
                        <th>Tồn kho</th>
                        <th>Mô tả</th>
                        <th>Ngày thêm</th>
                        <th>Cập nhật</th>
                        <th>Ảnh</th>
                        <th>File</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        var anh = listAnh?
                            .FirstOrDefault(x => x.MASACH == item.MASACH)?
                            .LINKANH ?? "default.jpg";

                        <tr>
                            <td class="text-center fw-semibold">@item.MASACH</td>
                            <td class="text-center">@item.MADANHMUC_CHILD</td>
                            <td class="fw-semibold">@item.TENSACH</td>
                            <td>@item.TACGIA</td>
                            <td>@item.NHAXUATBAN</td>
                            <td class="text-center">
                                <span class="badge bg-danger">
                                    @item.GIABAN
                                </span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-success">
                                    @item.SOLUONGTONKHO
                                </span>
                            </td>
                            <td class="text-muted small">@item.MOTACHITIET</td>
                            <td class="text-center small">@item.NGAYTHEMSANPHAM</td>
                            <td class="text-center small">@item.NGAYCAPNHAT</td>
                            <td class="text-center">
                                <img src="@Url.Content("~/Content/" + anh)"
                                     class="img-thumbnail"
                                     style="width:100px;height:130px;object-fit:cover;" />
                            </td>
                            <td class="small">@item.MOTAFILE</td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm">
                                    <a class="btn btn-outline-warning"
                                       href="@Url.Action("EditKhoNhanVien","Manager", new { id = item.MASACH })">
                                        Sửa
                                    </a>
                                    <a class="btn btn-outline-info"
                                       href="@Url.Action("DetailAction","Home", new { id = item.MASACH })">
                                        Chi tiết
                                    </a>

                                    @if (Session["role"] != null && Session["role"].ToString().Trim() == "Admin")
                                    {
                                        <a class="btn btn-outline-danger"
                                           href="@Url.Action("xoaSPView","Manager", new { id = item.MASACH })">
                                            Xóa
                                        </a>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>

</div>
